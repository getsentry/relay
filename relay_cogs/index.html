<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Break down the cost of Relay by its components and individual features it handles."><title>relay_cogs - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-1a91846b.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="relay_cogs" data-themes="" data-resource-suffix="" data-rustdoc-version="1.88.0 (6b00bc388 2025-06-23)" data-channel="1.88.0" data-search-js="search-f7877310.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-4e99c027.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-7ef8a74a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/getsentry/relay/master/artwork/relay-icon.png"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../relay_cogs/index.html"><img src="https://raw.githubusercontent.com/getsentry/relay/master/artwork/relay-icon.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../relay_cogs/index.html"><img src="https://raw.githubusercontent.com/getsentry/relay/master/artwork/relay-icon.png" alt="logo"></a><h2><a href="../relay_cogs/index.html">relay_<wbr>cogs</a><span class="version">25.7.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#collecting-cogs-measurements" title="Collecting COGs Measurements">Collecting COGs Measurements</a></li></ul><h3><a href="#macros">Crate Items</a></h3><ul class="block"><li><a href="#macros" title="Macros">Macros</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#traits" title="Traits">Traits</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>relay_cogs</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/relay_cogs/lib.rs.html#1-238">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Break down the cost of Relay by its components and individual features it handles.</p>
<p>Relay is a one stop shop for all different kinds of events Sentry supports, Errors,
Performance, Metrics, Replays, Crons and more. A single shared resource.</p>
<p>This module intends to make it possible to give insights how much time and resources
Relay spends processing individual features. The measurements collected can be later used
for increased observability and accounting purposes.</p>
<p><code>relay-cogs</code> provides a way to give an answer to the questions:</p>
<ul>
<li>What portion of Relay’s costs can be attributed to feature X?</li>
<li>How much does feature X cost?</li>
</ul>
<h3 id="collecting-cogs-measurements"><a class="doc-anchor" href="#collecting-cogs-measurements">§</a>Collecting COGs Measurements</h3>
<p>Measurements are collected through <a href="struct.Cogs.html" title="struct relay_cogs::Cogs"><code>Cogs</code></a> which attributes the measurement to either a single
or to multiple different <a href="enum.AppFeature.html" title="enum relay_cogs::AppFeature">app features</a> belonging to a <a href="enum.ResourceId.html" title="enum relay_cogs::ResourceId">resource</a>.</p>
<p>Collected and <a href="struct.CogsMeasurement.html" title="struct relay_cogs::CogsMeasurement">attributed measurements</a> then are recorded by a <a href="trait.CogsRecorder.html" title="trait relay_cogs::CogsRecorder"><code>CogsRecorder</code></a>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>relay_cogs::{AppFeature, Cogs, FeatureWeights, ResourceId};

<span class="kw">enum </span>Message {
    Span,
    Transaction,
    TransactionWithSpans { num_spans: usize },
}

<span class="kw">struct </span>Processor {
    cogs: Cogs
}

<span class="kw">impl </span>From&lt;<span class="kw-2">&amp;</span>Message&gt; <span class="kw">for </span>FeatureWeights {
    <span class="kw">fn </span>from(value: <span class="kw-2">&amp;</span>Message) -&gt; <span class="self">Self </span>{
        <span class="kw">match </span>value {
            Message::Span =&gt; FeatureWeights::new(AppFeature::Spans),
            Message::Transaction =&gt; FeatureWeights::new(AppFeature::Transactions),
            Message::TransactionWithSpans { num_spans } =&gt; FeatureWeights::builder()
                .weight(AppFeature::Spans, <span class="kw-2">*</span>num_spans)
                .weight(AppFeature::Transactions, <span class="number">1</span>)
                .build(),
        }
    }
}

<span class="kw">impl </span>Processor {
    <span class="kw">fn </span>handle_message(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="kw-2">mut </span>message: Message) {
        <span class="kw">let </span>_cogs = <span class="self">self</span>.cogs.timed(ResourceId::Relay, <span class="kw-2">&amp;</span>message);

        <span class="self">self</span>.step1(<span class="kw-2">&amp;mut </span>message);
        <span class="self">self</span>.step2(<span class="kw-2">&amp;mut </span>message);

        <span class="comment">// Measurement automatically recorded here.
    </span>}
}</code></pre></div>
</div></details><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">§</a></h2><dl class="item-table"><dt><a class="macro" href="macro.with.html" title="macro relay_cogs::with">with</a></dt><dd>Records a categorized measurement of the passed <code>body</code>, in <code>category</code> on <code>token</code>.</dd></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.CategoryToken.html" title="struct relay_cogs::CategoryToken">Category<wbr>Token</a></dt><dd>A categorized COGS measurement.</dd><dt><a class="struct" href="struct.Cogs.html" title="struct relay_cogs::Cogs">Cogs</a></dt><dd>COGS measurements collector.</dd><dt><a class="struct" href="struct.CogsMeasurement.html" title="struct relay_cogs::CogsMeasurement">Cogs<wbr>Measurement</a></dt><dd>A COGS measurement.</dd><dt><a class="struct" href="struct.FeatureWeights.html" title="struct relay_cogs::FeatureWeights">Feature<wbr>Weights</a></dt><dd>A collection of weighted <a href="enum.AppFeature.html" title="enum relay_cogs::AppFeature">app features</a>.</dd><dt><a class="struct" href="struct.FeatureWeightsBuilder.html" title="struct relay_cogs::FeatureWeightsBuilder">Feature<wbr>Weights<wbr>Builder</a></dt><dd>A builder for <a href="struct.FeatureWeights.html" title="struct relay_cogs::FeatureWeights"><code>FeatureWeights</code></a> which can be used to configure different weights per <a href="enum.AppFeature.html" title="enum relay_cogs::AppFeature"><code>AppFeature</code></a>.</dd><dt><a class="struct" href="struct.NoopRecorder.html" title="struct relay_cogs::NoopRecorder">Noop<wbr>Recorder</a></dt><dd>A recorder which discards all measurements.</dd><dt><a class="struct" href="struct.Token.html" title="struct relay_cogs::Token">Token</a></dt><dd>An in progress COGS measurement.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.AppFeature.html" title="enum relay_cogs::AppFeature">AppFeature</a></dt><dd>App feature a COGS measurement is related to.</dd><dt><a class="enum" href="enum.ResourceId.html" title="enum relay_cogs::ResourceId">Resource<wbr>Id</a></dt><dd>Resource ID as tracked in COGS.</dd><dt><a class="enum" href="enum.Value.html" title="enum relay_cogs::Value">Value</a></dt><dd>A COGS measurement value.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.Category.html" title="trait relay_cogs::Category">Category</a></dt><dd>A COGS category.</dd><dt><a class="trait" href="trait.CogsRecorder.html" title="trait relay_cogs::CogsRecorder">Cogs<wbr>Recorder</a></dt><dd>Cogs recorder, recording actual measurements.</dd></dl></section></div></main></body></html>