name: Release Build

# TODO: Only push
on:
  - push
  - pull_request

jobs:
  linux:
    name: Build (Linux)
    runs-on: ubuntu-latest

    # Only build on binary release branches
    if: "startsWith(github.ref, 'refs/heads/release/')"

    steps:
      - uses: actions/checkout@v2
        with:
          submodules: recursive

      # - name: Build in Docker
      #   run: scripts/docker-build-linux.sh
      #   env:
      #     BUILD_ARCH: x86_64

      - uses: actions/setup-node@v1

      - name: Upload to Zeus
        env:
          ZEUS_API_TOKEN: ${{ secrets.ZEUS_API_TOKEN }}
          ZEUS_HOOK_BASE: ${{ secrets.ZEUS_HOOK_BASE }}
        run: |
          npm install -D @zeus-ci/cli
          npx zeus job update -b $GITHUB_RUN_ID -j $GITHUB_RUN_NUMBER -r $GITHUB_SHA
          # npx zeus upload -b $GITHUB_RUN_ID -j $GITHUB_RUN_NUMBER -t "application/octet-stream" -n relay-Linux-x86_64 target/x86_64-unknown-linux-gnu/release/relay
          # npx zeus upload -b $GITHUB_RUN_ID -j $GITHUB_RUN_NUMBER -t "application/octet-stream" -n relay-Linux-x86_64-debug.zip relay-debug.zip
          npx zeus job update --status=passed -b $GITHUB_RUN_ID -j $GITHUB_RUN_NUMBER -r $GITHUB_SHA
