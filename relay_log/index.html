<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Error reporting and logging facade for Relay."><title>relay_log - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="relay_log" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0 (cc66ad468 2023-10-03)" data-channel="1.73.0" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-1596385f77d47ef2.css" data-theme-dark-css="dark-0a43001d3fc2282c.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../static.files/light-1596385f77d47ef2.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../static.files/dark-0a43001d3fc2282c.css"><link rel="stylesheet" href="../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/getsentry/relay/master/artwork/relay-icon.png"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../relay_log/index.html"><img src="https://raw.githubusercontent.com/getsentry/relay/master/artwork/relay-icon.png" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../relay_log/index.html"><img src="https://raw.githubusercontent.com/getsentry/relay/master/artwork/relay-icon.png" alt="logo"></a><h2 class="location"><a href="#">Crate relay_log</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 23.10.1</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">relay_log</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/relay_log/lib.rs.html#1-137">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Error reporting and logging facade for Relay.</p>
<h2 id="setup"><a href="#setup">Setup</a></h2>
<p>To enable logging, invoke the <a href="fn.init.html" title="fn relay_log::init"><code>init</code></a> function with <a href="struct.LogConfig.html" title="struct relay_log::LogConfig"><code>logging</code></a> and
<a href="struct.SentryConfig.html" title="struct relay_log::SentryConfig"><code>sentry</code></a> configuration. The configuration implements <code>serde</code> traits, so it can
be obtained from configuration files.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>relay_log::{LogConfig, SentryConfig};

<span class="kw">let </span>log_config = LogConfig {
    enable_backtraces: <span class="bool-val">true</span>,
    ..LogConfig::default()
};

<span class="kw">let </span>sentry_config = SentryConfig {
    enabled: <span class="bool-val">true</span>,
    ..SentryConfig::default()
};

relay_log::init(<span class="kw-2">&amp;</span>log_config, <span class="kw-2">&amp;</span>sentry_config);</code></pre></div>
<h2 id="logging"><a href="#logging">Logging</a></h2>
<p>The basic use of the log crate is through the five logging macros: <a href="macro.error.html" title="macro relay_log::error"><code>error!</code></a>, <a href="macro.warn.html" title="macro relay_log::warn"><code>warn!</code></a>,
<a href="macro.info.html" title="macro relay_log::info"><code>info!</code></a>, <a href="macro.debug.html" title="macro relay_log::debug"><code>debug!</code></a> and <a href="macro.trace.html" title="macro relay_log::trace"><code>trace!</code></a> where <code>error!</code> represents the highest-priority log messages
and <code>trace!</code> the lowest. The log messages are filtered by configuring the log level to exclude
messages with a lower priority. Each of these macros accept format strings similarly to
<a href="https://doc.rust-lang.org/1.73.0/std/macro.println.html" title="macro std::println"><code>println!</code></a>.</p>
<h3 id="conventions"><a href="#conventions">Conventions</a></h3>
<p>Log messages should start lowercase and end without punctuation. Prefer short and precise log
messages over verbose text. Choose the log level according to these rules:</p>
<ul>
<li><a href="macro.error.html" title="macro relay_log::error"><code>error!</code></a> for bugs and invalid behavior. This will also be reported to Sentry.</li>
<li><a href="macro.warn.html" title="macro relay_log::warn"><code>warn!</code></a> for undesirable behavior.</li>
<li><a href="macro.info.html" title="macro relay_log::info"><code>info!</code></a> for messages relevant to the average user.</li>
<li><a href="macro.debug.html" title="macro relay_log::debug"><code>debug!</code></a> for messages usually relevant to debugging.</li>
<li><a href="macro.trace.html" title="macro relay_log::trace"><code>trace!</code></a> for full auxiliary information.</li>
</ul>
<h3 id="examples"><a href="#examples">Examples</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="macro">relay_log::info!</span>(duration = <span class="question-mark">?</span>startup_time, <span class="string">&quot;startup complete&quot;</span>);</code></pre></div>
<h2 id="error-reporting"><a href="#error-reporting">Error Reporting</a></h2>
<p><code>sentry</code> is used for error reporting of all messages logged with an ERROR level. To add custom
information, add fields with the <code>tags.</code> prefix.</p>
<h3 id="tags-and-fields"><a href="#tags-and-fields">Tags and Fields</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="macro">relay_log::error!</span>(
    tags.custom = <span class="string">&quot;value&quot;</span>,            <span class="comment">// will become a tag in Sentry
    </span>field = <span class="string">&quot;value&quot;</span>,                  <span class="comment">// will become a context field
    </span><span class="string">&quot;this message has a custom tag&quot;</span>,
);</code></pre></div>
<h3 id="logging-error-types"><a href="#logging-error-types">Logging Error Types</a></h3>
<p>To log <a href="https://doc.rust-lang.org/1.73.0/core/error/trait.Error.html" title="trait core::error::Error">errors</a> to both Sentry and the error stream, use <a href="macro.error.html" title="macro relay_log::error"><code>error!</code></a> and
assign a reference to the error as <code>error</code> field. This formats the error with all its sources,
and ensures the format is suitable for error reporting to Sentry.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::error::Error;
<span class="kw">use </span>std::io;

<span class="kw">let </span>custom_error = io::Error::new(io::ErrorKind::Other, <span class="string">&quot;oh no!&quot;</span>);
<span class="macro">relay_log::error!</span>(error = <span class="kw-2">&amp;</span>custom_error <span class="kw">as </span><span class="kw-2">&amp;</span><span class="kw">dyn </span>Error, <span class="string">&quot;operation failed&quot;</span>);</code></pre></div>
<p>Alternatively, higher level self-explanatory errors can be passed without an additional message.
They are displayed in the same way in log output, but in Sentry they will display with the error
type as primary title.</p>
<h3 id="capturing-without-logging"><a href="#capturing-without-logging">Capturing without Logging</a></h3>
<p>Additionally, errors can be captured without logging.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::io::{Error, ErrorKind};

<span class="kw">let </span>custom_error = Error::new(ErrorKind::Other, <span class="string">&quot;oh no!&quot;</span>);
relay_log::capture_error(<span class="kw-2">&amp;</span>custom_error);</code></pre></div>
<h2 id="testing"><a href="#testing">Testing</a></h2>
<p>For unit testing, there is a separate initialization macro <a href="macro.init_test.html" title="macro relay_log::init_test"><code>init_test!</code></a> that should be called
at the beginning of test method. It enables test mode of the logger and customizes log levels
for the current crate.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[test]
</span><span class="kw">fn </span>test_something() {
    <span class="macro">relay_log::init_test!</span>();
}</code></pre></div>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.tower"><code>pub use sentry::integrations::tower;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="dashboard/index.html" title="mod relay_log::dashboard">dashboard</a></div><div class="desc docblock-short">This module provides the functionality for subscribing to the logs stream and delivering it to
the external consumers through the [<code>tokio::sync::broadcast</code>] channel.</div></li><li><div class="item-name"><a class="mod" href="protocol/index.html" title="mod relay_log::protocol">protocol</a></div><div class="desc docblock-short">The current latest sentry protocol version.</div></li></ul><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.debug.html" title="macro relay_log::debug">debug</a></div><div class="desc docblock-short">Constructs an event at the debug level.</div></li><li><div class="item-name"><a class="macro" href="macro.error.html" title="macro relay_log::error">error</a></div><div class="desc docblock-short">Constructs an event at the error level.</div></li><li><div class="item-name"><a class="macro" href="macro.info.html" title="macro relay_log::info">info</a></div><div class="desc docblock-short">Constructs an event at the info level.</div></li><li><div class="item-name"><a class="macro" href="macro.init_test.html" title="macro relay_log::init_test">init_test</a></div><div class="desc docblock-short">Initialize the logger for testing.</div></li><li><div class="item-name"><a class="macro" href="macro.trace.html" title="macro relay_log::trace">trace</a></div><div class="desc docblock-short">Constructs an event at the trace level.</div></li><li><div class="item-name"><a class="macro" href="macro.warn.html" title="macro relay_log::warn">warn</a></div><div class="desc docblock-short">Constructs an event at the warn level.</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Hub.html" title="struct relay_log::Hub">Hub</a></div><div class="desc docblock-short">The central object that can manages scopes and clients.</div></li><li><div class="item-name"><a class="struct" href="struct.Level.html" title="struct relay_log::Level">Level</a></div><div class="desc docblock-short">Describes the level of verbosity of a span or event.</div></li><li><div class="item-name"><a class="struct" href="struct.LogConfig.html" title="struct relay_log::LogConfig">LogConfig</a></div><div class="desc docblock-short">Controls the logging system.</div></li><li><div class="item-name"><a class="struct" href="struct.SentryConfig.html" title="struct relay_log::SentryConfig">SentryConfig</a></div><div class="desc docblock-short">Controls internal reporting to Sentry.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.LogFormat.html" title="enum relay_log::LogFormat">LogFormat</a></div><div class="desc docblock-short">Controls the log format.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.backtrace_enabled.html" title="fn relay_log::backtrace_enabled">backtrace_enabled</a></div><div class="desc docblock-short">Returns <code>true</code> if backtrace printing is enabled.</div></li><li><div class="item-name"><a class="fn" href="fn.capture_error.html" title="fn relay_log::capture_error">capture_error</a></div><div class="desc docblock-short">Captures a <code>std::error::Error</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.configure_scope.html" title="fn relay_log::configure_scope">configure_scope</a></div><div class="desc docblock-short">Invokes a function that can modify the current scope.</div></li><li><div class="item-name"><a class="fn" href="fn.ensure_error.html" title="fn relay_log::ensure_error">ensure_error</a></div><div class="desc docblock-short">Logs an error to the configured logger or <code>stderr</code> if not yet configured.</div></li><li><div class="item-name"><a class="fn" href="fn.init.html" title="fn relay_log::init">init</a></div><div class="desc docblock-short">Initialize the logging system and reporting to Sentry.</div></li><li><div class="item-name"><a class="fn" href="fn.with_scope.html" title="fn relay_log::with_scope">with_scope</a></div><div class="desc docblock-short">Temporarily pushes a scope for a single call optionally reconfiguring it.</div></li></ul></section></div></main></body></html>